#include <behaviors.dtsi>
#include "zmk-helpers/helper.h"
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/ext_power.h>

#include "../../layouts/50-keys.h"

#include "../layers.dtsi"
#include "../mouse.dtsi"
#include "../macros.dtsi"
#include "../combos.dtsi"
#include "../behaviours.dtsi"

/ {
    keymap {
        compatible = "zmk,keymap";

        default_layer {
            display-name = "Base";

            bindings = <LAYER_FROM50( \
&kp TAB,  &kp Q,          &kp W,         &kp E,          &kp R,                &kp T,                      &kp Y,         &kp U,                &kp I,            &kp O,         &kp P,             &kp BSLH,
&kp ESC,  &hm_l LGUI A,   &hm_l LALT S,  &hm_l LCTRL D,  &hm_shift_l LSHFT F,  &kp G,                      &kp H,         &hm_shift_r RSHFT J,  &hm_r RCTRL K,    &hm_r RALT L,  &hm_r RGUI &mm_quote_colon,   &kp SQT,
&mo MACRO,    &hm_l LGUI Z,   &kp X,         &kp C,          &kp V,                &kp B,        &none,  &none,  &kp N,         &kp M,                &mm_minus_pipe,   &mm_dot_comma, &hm_l RGUI FSLH,   &kp BACKSPACE,
&none,    &none,          &none,         &kp ESCAPE,     &lt MACRO BACKSPACE,      &lt NAVI SPACE,                &lt SYMBOL ENTER,   &lt NUM ESCAPE,         &lt 5 BACKSPACE,  &none,         &none,             &none
            )>;
            sensor-bindings = <&inc_dec_kp K_VOL_UP K_VOL_DN &inc_dec_kp PG_UP PG_DN>;
        };
        Symbol_layer {
            display-name = "Symbols";
            bindings = <LAYER_FROM50( \
&none,  &kp GRAVE,  &kp ASTRK,  &kp EQUAL,  &kp EXCL,  &kp CARET,                  &kp SQT,    &kp DQT,      &kp PRCNT,  &kp BSLH,   &kp TILDE,  &kp PIPE,
&none,  &kp N0,     &kp LBKT,   &kp LBRC,   &kp LPAR,  &kp UNDER,                  &kp MINUS,  &kp RPAR,     &kp RBRC,   &kp RBKT,   &kp DLLR,   &kp SQT,
&none,  &kp HASH,   &kp AMPS,   &kp AT,     &kp LT,    &kp FSLH,   &trans,  &trans,  &kp EQUAL,  &kp GT,       &kp COMMA,  &kp DOT,    &kp SEMI,   &none,
&none,  &none,      &none,      &none,      &trans,    &kp TAB,                     &trans,     &trans,       &trans,     &none,      &none,      &none
            )>;
            sensor-bindings = <&inc_dec_kp K_VOL_UP K_VOL_DN &inc_dec_kp PG_UP PG_DN>;
        };

        Navi_layer {
            display-name = "Navi";
            bindings = <LAYER_FROM50( \
&none, &none,  &kp K_PREVIOUS,  &kp K_VOLUME_UP,   &kp K_NEXT,        &none,                  &none,           &mkp MB1,        &msc SCRL_UP,    &mkp MB2,           &none, &none,
&none, &none,  &mkp MB2,        &kp K_MUTE,        &mkp MB1,          &none,                  &mmv MOVE_LEFT,  &mmv MOVE_DOWN,  &mmv MOVE_UP,    &mmv MOVE_RIGHT,    &none, &none,
&none, &none,  &mkp MB3,        &kp K_VOLUME_DOWN, &kp K_PLAY_PAUSE,  &none,  &trans,  &trans,  &none,           &msc SCRL_LEFT,  &msc SCRL_DOWN,  &msc SCRL_RIGHT,    &none, &none,
&none, &none,  &none,           &mkp MB3,          &trans,            &trans,                 &mkp MB1,        &mkp MB2,        &trans,          &none,              &none, &none
            )>;
        };

        KeyPad_layer {
            display-name = "NumPad";
            bindings = <LAYER_FROM50( \
&none, &none,   &kp N7,      &kp N8,  &kp N9,   &kp KP_PLUS,                        &none,           &kp HOME,        &kp PAGE_UP,     &kp INSERT,       &none,            &none, 
&none, &none,   &kp N4,      &kp N5,  &kp N6,   &kp KP_MINUS,                       &kp LEFT_ARROW,  &kp DOWN_ARROW,  &kp UP_ARROW,    &kp RIGHT_ARROW,  &none,            &none,
&none, &kp N0,   &kp N1,      &kp N2,  &kp N3,   &kp KP_MULTIPLY, &trans,  &trans,     &none,           &kp END,         &kp PAGE_DOWN,   &trans,           &kp C_RESET,      &none,
&none, &kp N0,  &kp KP_DOT,  &kp N0,  &kp DEL,  &kp N0,                             &none,           &none,           &none,           &none,            &none,            &mo 7
            )>;
        };
        Macro_layer {
            display-name = "Macro";

            bindings = <LAYER_FROM50( \
&none, &none,           &none, &none, &none, &none,               &none, &none, &none, &none, &none,             &none,
&none, &none,           &none, &none, &none, &none,               &none, &none, &none, &none, &none,             &none,
&none, &email_macro,    &none, &none, &none, &none, &trans, &trans, &none, &none, &none, &none, &my_user_macro,    &none,
&none, &none,           &none, &none, &none, &none,               &none, &none, &none, &none, &none,             &none
            )>;
        };
        Debug_layer {
            display-name = "Debug";

            bindings = <LAYER_FROM50( \
&bt BT_CLR,  &bt BT_SEL 0,  &bt BT_SEL 1,  &bt BT_SEL 2,  &bt BT_SEL 3,  &bt BT_SEL 4,                  &none,        &out OUT_USB,  &out OUT_TOG,   &out OUT_BLE,  &none,  &none,
&none,       &none,         &none,         &none,         &none,         &none,                         &none,        &none,         &none,          &none,         &none,  &none,
&none,       &none,         &none,         &none,         &none,         &bootloader,   &trans,  &trans,  &bootloader,  &none,         &none,          &none,         &none,  &none,
&none,       &none,         &none,         &none,         &none,         &none,                         &none,        &none,         &kp N7,         &none,         &none,  &none
            )>;
        };
    };
};
